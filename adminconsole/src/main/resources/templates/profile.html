<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/mySentries.css">
    <link rel="stylesheet" href="css/profile.css">
    <title>My Profile</title>
</head>
<body>
    <div class="navbar">
        <div class="logo">Logo</div>
        <nav class="nav-links">
            <a th:href="@{home}">Home</a>
            <a th:href="@{about}">About</a>
            <a th:href="@{guide}">Guide</a>
            <a th:href="@{profile}">Profile</a>
            <a th:href="@{dashboard}">Dashboard</a>
            <a th:href="@{mySentries}">My Sentries</a>
        </nav>
    </div>
    <!-- <button class="sidebar-toggle" onclick="toggleSidebar()">â‡’</button> -->
    <!-- <div class="sidebar" id="sidebar">

    </div> -->
    <!-- <div class="content"> -->
        <div class="main-div" style="background-color: transparent;">
            <!-- <h1>My Profile</h1>
            <img th:src= "@{/images/userpfp.png}" class="profile-pic"/> -->
            <div class="account-container">
                <h1 style="margin-bottom: 1%; margin-top: 5%;">My Profile</h1>
                <img th:src= "@{/images/userpfp.png}" class="profile-pic" style="margin-bottom: 2%;"/>
                <form>
                  <div class="form-group">
                    <label for="firstName">First Name</label><br>
                    <input id="firstName" class="account-input" type="text" name="firstName" disabled />
                  </div>
                  <div class="form-group">
                    <label for="lastName">Last Name</label><br>
                    <input id="lastName" class="account-input" type="text" name="lastName" disabled />
                  </div>
                  <div class="form-group">
                    <label for="email">Email</label><br>
                    <input id="email" class="account-input" type="email" name="email" disabled />
                  </div>
                  <button class="ran-button" onclick="eraseCookie('AUTH-TOKEN')">Log out</button>
                </form>
              </div>

            <!-- <div class="profile-info">
                <img th:src= "@{/images/userpfp.png}" class="profile-pic"/>
                <h2>User Information</h2>
                <p><strong>First Name:</strong> <span id="firstName"></span></p>
                <p><strong>Last Name:</strong> <span id="lastName"></span></p>
                <p><strong>Email:</strong> <span id="email"></span></p>
            </div> -->
        </div>
    <!-- </div> -->

    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function eraseCookie(name) {   
            document.cookie = name+'=; Max-Age=-99999999;';
            window.location.href = 'home';
        }

        function fetchUserInfo() {
            const token = getCookie('AUTH-TOKEN');
            if (!token) {
                console.error('No AUTH-TOKEN found');
                return; // Exit if no token
            }

            fetch('https://www.eco-sentry.com/api/get-user-info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: token
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('firstName').value = data.fname;
                document.getElementById('lastName').value = data.lname;
                document.getElementById('email').value = data.email;
            })
            .catch(error => console.error('Error fetching user info:', error));
        }

        document.addEventListener('DOMContentLoaded', function () {
            fetchUserInfo();
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar.style.transform === 'translateX(0px)') {
                sidebar.style.transform = 'translateX(-100%)'; // Hide the sidebar
            } else {
                sidebar.style.transform = 'translateX(0px)'; // Show the sidebar
            }
        }

        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth >= 768) {
                // Ensure sidebar is open on larger screens
                sidebar.style.transform = 'translateX(0px)';
            } else if (window.innerWidth < 768 && sidebar.style.transform === 'translateX(0px)') {
                // Keep current state if the sidebar is already open
                sidebar.style.transform = 'translateX(-100%)';
                return;
            } else {
                // Ensure sidebar is closed on smaller screens when not specifically toggled
                sidebar.style.transform = 'translateX(-100%)';
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
            const navbar = document.querySelector('.navbar');

            navbar.addEventListener('click', function(event) {
                if (window.innerWidth < 768) {
                    navbar.classList.toggle('active');
                    if (navbar.classList.contains('active')) {
                        navbar.style.height = '100vh'; // Full height
                    } else {
                        navbar.style.height = '60px'; // Default height
                    }
                }
            });

            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768) {
                    navbar.classList.remove('active');
                    navbar.style.height = '60px'; // Ensure default height
                }
            });

            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth >= 768) {
                // Ensure sidebar is open on larger screens
                sidebar.style.transform = 'translateX(0px)';
            } else if (window.innerWidth < 768 && sidebar.style.transform === 'translateX(0px)') {
                // Keep current state if the sidebar is already open
                return;
            } else {
                // Ensure sidebar is closed on smaller screens when not specifically toggled
                sidebar.style.transform = 'translateX(-100%)';
            }
        });
    </script>
</body>
</html>