<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/default.css">
    <title>Responsive Layout</title>
</head>
<body>
    <div class="navbar">
        <div class="logo">Logo</div>
        <nav class="nav-links">
            <a href="#home">Home</a>
            <a href="#about">About</a>
            <a href="#profile">Profile</a>
            <a href="#dashboard">Dashboard</a>
        </nav>
    </div>
    <button class="sidebar-toggle" onclick="toggleSidebar()">⇒</button>
    <div class="sidebar" id="sidebar">
        <div>
            <input type="datetime-local" id="startTimeInput" value="2024-05-06T04:01">
            <input type="datetime-local" id="endTimeInput" value="2024-05-06T06:40">
            <input type="number" id="rangeInput" value="1000000">
            <button onclick="refreshIframe()">Refresh</button>
            <iframe id="dataFrame" style="width: 100%; height: 600px; border: none;"></iframe>
        </div>
    </div>
    <div class="content">
        <div class="search-area">
            <input type="text" class="search-input" placeholder="Search...">
            <button class="search-button">Search</button>
        </div>
        <div class="main-div">















            <iframe id="dataFrame" style="width: 100%; height: 600px; border: none;"></iframe>
            <script>
                const iframe = document.getElementById('dataFrame');
            
                function refreshIframe() {
                    const startTime = document.getElementById('startTimeInput').value;
                    const endTime = document.getElementById('endTimeInput').value;
                    const range = document.getElementById('rangeInput').value;
            
                    fetch('http://202.65.64.38:5000/generate-multi-sensor-graph', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            startTime,
                            endTime,
                            longitude: "150.89494",
                            latitude: "-34.39212",
                            range,
                            sensorTypes: ["ba280d1f-e1ee-4cff-b695-101e3a9e211b", "b53a5c22-63c0-4201-9df3-bc16d0d263b5"]
                        })
                    }).then(response => response.text())
                    .then(html => {
                        const doc = iframe.contentWindow.document;
                        doc.open();
                        doc.write(html);
                        doc.close();
                    }).catch(error => console.error('Error loading the iframe content:', error));
                }
            
                refreshIframe(); // Initial load
            
            </script>
        </div>











    </div>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar.style.transform === 'translateX(0px)') {
                sidebar.style.transform = 'translateX(-100%)'; // Hide the sidebar
            } else {
                sidebar.style.transform = 'translateX(0px)'; // Show the sidebar
            }
        }
        // Add event listener to handle window resizing
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth >= 768) {
                // Ensure sidebar is open on larger screens
                sidebar.style.transform = 'translateX(0px)';
            } else if (window.innerWidth < 768 && sidebar.style.transform === 'translateX(0px)') {
                // Keep current state if the sidebar is already open
                sidebar.style.transform = 'translateX(-100%)';
                return;
            } else {
                // Ensure sidebar is closed on smaller screens when not specifically toggled
                sidebar.style.transform = 'translateX(-100%)';
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            const navbar = document.querySelector('.navbar');

            navbar.addEventListener('click', function(event) {
                if (window.innerWidth < 768) {
                    navbar.classList.toggle('active');
                    if (navbar.classList.contains('active')) {
                        navbar.style.height = '100vh'; // Full height
                    } else {
                        navbar.style.height = '60px'; // Default height
                    }
                }
            });

            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768) {
                    navbar.classList.remove('active');
                    navbar.style.height = '60px'; // Ensure default height
                }
            });

            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth >= 768) {
                // Ensure sidebar is open on larger screens
                sidebar.style.transform = 'translateX(0px)';
            } else if (window.innerWidth < 768 && sidebar.style.transform === 'translateX(0px)') {
                // Keep current state if the sidebar is already open
                return;
            } else {
                // Ensure sidebar is closed on smaller screens when not specifically toggled
                sidebar.style.transform = 'translateX(-100%)';
            }
        });



    </script>
</body>
</html> -->

























<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/default.css">
    <title>Dashboard</title>

    <style>
        #searchList {
          height: 200px;
          overflow-y: auto;
          border: 1px solid #ccc;
          width: 300px;
          padding: 5px;
        }
        .item {
          margin: 5px;
        }
      </style>

</head>
<body>
    <div class="navbar">
        <div class="logo">
            <img src="images/Logo.png" alt="Logo" class="logo-image">         
        </div>
        
        <nav class="nav-links">
            <a th:href="@{home}">Home</a>
            <a th:href="@{about}">About</a>
            <a th:href="@{guide}">Guide</a>
            <a th:href="@{profile}">Profile</a>
            <a th:href="@{dashboard}">Dashboard</a>
            <a th:href="@{mySentries}">My Sentries</a>
        </nav>
    </div>
    <button class="sidebar-toggle" onclick="toggleSidebar()">⇒</button>
    <div class="sidebar" id="sidebar">



        <label>
            <input type="radio" name="graphType" value="multi-sensor" checked>
            Multi-Sensor Graph
        </label>
        <label>
            <input type="radio" name="graphType" value="correlation">
            Correlation Plot
        </label>
        <label>
            <input type="radio" name="graphType" value="heatmap">
            Heatmap
        </label>
        <label>
            <input type="radio" name="graphType" value="scatter">
            Scatter Plot
        </label>



        <div>
            <input type="datetime-local" id="startTimeInput" value="2024-05-06T04:01">
            <input type="datetime-local" id="endTimeInput" value="2024-05-06T06:40">
            <input type="number" id="rangeInput" value="1000000">
            <button onclick="refreshIframe()">Refresh</button>
        </div>

        <input type="text" id="searchInput" onkeyup="filterList()" placeholder="Search for names...">
        <div id="searchList"></div>
    </div>
    <div class="content">
        <div class="search-area">
            <input type="text" class="search-input" id="address" placeholder="Search..." oninput="showSuggestions()" >
            <button class="search-button" onclick="geocode()">Search</button>
            


            <!-- <input type="text" id="address" placeholder="Enter address" oninput="showSuggestions()">
            <button onclick="geocode()">Search</button>
            </br>
            <div id="suggestions"></div>
            </br> -->
            
            

        </div>
        <div id="suggestions"></div>
        <p id="result"></p>

        
        <div class="main-div">
            <iframe id="dataFrame" style="width: 100%; height: 80vh; border: none;"></iframe>
        </div>
    </div>
    <script>
        // function showSuggestions() {
        //     const address = document.getElementById('address').value;
        //     if (address.length < 3) {
        //         document.getElementById('suggestions').innerHTML = '';
        //         return;
        //     }

        //     const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&addressdetails=1&limit=3`;

        //     fetch(url)
        //         .then(response => response.json())
        //         .then(data => {
        //             const suggestions = document.getElementById('suggestions');
        //             suggestions.innerHTML = '';
        //             if (data.length > 0) {
        //                 data.forEach(item => {
        //                     const suggestion = document.createElement('div');
        //                     suggestion.classList.add('suggestion');
        //                     suggestion.innerText = item.display_name;
        //                     suggestion.onclick = () => {
        //                         document.getElementById('address').value = item.display_name;
        //                         suggestions.innerHTML = '';
        //                     };
        //                     suggestions.appendChild(suggestion);
        //                 });
        //             } else {
        //                 suggestions.innerHTML = '<div class="suggestion">No results found</div>';
        //             }
        //         })
        //         .catch(error => {
        //             console.error('Error:', error);
        //         });
        // }

        // function geocode() {
        //     const address = document.getElementById('address').value;
        //     const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;

        //     fetch(url)
        //         .then(response => response.json())
        //         .then(data => {
        //             if (data.length > 0) {
        //                 const result = data[0];
        //                 document.getElementById('result').innerText = `Latitude: ${result.lat}, Longitude: ${result.lon}`;
        //             } else {
        //                 document.getElementById('result').innerText = 'No results found';
        //             }
        //         })
        //         .catch(error => {
        //             console.error('Error:', error);
        //             document.getElementById('result').innerText = 'An error occurred';
        //         });
        // }
        let debounceTimeout;
        var fullLong;
        var fullLat;
        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const showSuggestions = debounce(function() {
            const address = document.getElementById('address').value;
            if (address.length < 3) {
                document.getElementById('suggestions').innerHTML = '';
                return;
            }

            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&addressdetails=1&limit=3`;


            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const suggestions = document.getElementById('suggestions');
                    suggestions.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(item => {
                            const suggestion = document.createElement('div');
                            suggestion.classList.add('suggestion');
                            suggestion.innerText = item.display_name;
                            suggestion.onclick = () => {
                                document.getElementById('address').value = item.display_name;
                                suggestions.innerHTML = '';
                            };
                            suggestions.appendChild(suggestion);
                        });
                    } else {
                        suggestions.innerHTML = '<div class="suggestion">No results found</div>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }, 1000);

        function geocode() {
            const address = document.getElementById('address').value;
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const result = data[0];
                        fullLat = result.lat;
                        fullLong = result.lon;
                        refreshIframe();
                        document.getElementById('result').innerText = `Latitude: ${result.lat}, Longitude: ${result.lon}`;
                    } else {
                        document.getElementById('result').innerText = 'No results found';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('result').innerText = 'An error occurred';
                });
        }
        // // Function to fetch sensor types from the API
        // async function fetchSensorTypes() {
        //   try {
        //     const response = await fetch('https://www.eco-sentry.com/api/get-sensor-types');
        //     const data = await response.json();
        //     // Sort data by popularity in descending order
        //     data.sort((a, b) => b.popularity - a.popularity);
        //     populateList(data);
        //   } catch (error) {
        //     console.error('Error fetching sensor types:', error);
        //   }
        // }
        
        // // Function to populate the list with items
        // function populateList(sensorTypes) {
        //   const listDiv = document.getElementById('searchList');
        //   sensorTypes.forEach(sensor => {
        //     const itemDiv = document.createElement('div');
        //     itemDiv.className = 'item';
        //     itemDiv.style.display = ''; // Make sure all items are visible initially
        //     itemDiv.innerHTML = `<input type="checkbox" id="${sensor.id}"> ${sensor.sensorType}`;
        //     itemDiv.dataset.popularity = sensor.popularity; // Store popularity as a data attribute
        //     listDiv.appendChild(itemDiv);
        //   });
        // }
        async function fetchSensorTypes() {
            try {
                const response = await fetch('https://www.eco-sentry.com/api/get-sensor-types');
                const data = await response.json();
                // Sort data by popularity in descending order
                data.sort((a, b) => b.popularity - a.popularity);
                populateList(data);
            } catch (error) {
                console.error('Error fetching sensor types:', error);
            }
        }

        // Function to populate the list with items
        function populateList(sensorTypes) {
            const listDiv = document.getElementById('searchList');
            sensorTypes.forEach((sensor, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.style.display = ''; // Make sure all items are visible initially
                // Modified line to ensure the first item is always checked
                itemDiv.innerHTML = `<input type="checkbox" id="${sensor.id}" ${index === 0 ? 'checked' : ''}> ${sensor.sensorType}`;
                itemDiv.dataset.popularity = sensor.popularity; // Store popularity as a data attribute
                listDiv.appendChild(itemDiv);
            });
            refreshIframe();
        }
        function getCheckedSensorIds() {
            const listDiv = document.getElementById('searchList');
            const checkboxes = listDiv.querySelectorAll('input[type="checkbox"]');
            const checkedIds = [];

            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                checkedIds.push(checkbox.id);
                }
            });

            return checkedIds;
        }
        
        // Function to filter the list based on search input
        function filterList() {
          var input, filter, div, items, txtValue, itemPopularity, popularityFilter;
          input = document.getElementById('searchInput');
          filter = input.value.toUpperCase();
          div = document.getElementById('searchList');
          items = div.getElementsByClassName('item');
          for (let i = 0; i < items.length; i++) {
            txtValue = items[i].textContent || items[i].innerText;
            itemPopularity = items[i].dataset.popularity;
            popularityFilter = filter.match(/\d+/) ? filter.match(/\d+/)[0] : null; // Extract numbers from filter input
            if (txtValue.toUpperCase().indexOf(filter.replace(/\d+/g, '').trim()) > -1 && 
                (popularityFilter === null || itemPopularity === popularityFilter)) {
              items[i].style.display = "";
            } else {
              items[i].style.display = "none";
            }
          }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const status = document.getElementById('status');
            const locationElement = document.getElementById('location');

            // Check if Geolocation is supported
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(success, error);
            } else {
                status.textContent = 'Geolocation is not supported by your browser';
            }

            // Success callback
            function success(position) {
                fullLat = position.coords.latitude;
                fullLong = position.coords.longitude;
                status.textContent = 'Location fetched successfully!';
                locationElement.textContent = `Latitude: ${latitude}, Longitude: ${longitude}`;
            }

            // Error callback
            function error() {
                status.textContent = 'Unable to retrieve your location';
            }
        });

        
        // Initial fetch of sensor types when the document loads
        document.addEventListener('DOMContentLoaded', fetchSensorTypes);
    </script>
    <script>
        function setupDateTimeInputs() {
            const now = new Date();
            const oneDayAgo = new Date(now.getTime() - (24 * 60 * 60 * 1000));
        
            // Formatting to datetime-local input format YYYY-MM-DDTHH:mm
            const formatDateTimeLocal = (date) => {
                const off = date.getTimezoneOffset();
                const adjustedDate = new Date(date.getTime() - off * 60 * 1000);
                return adjustedDate.toISOString().slice(0, 16);
            };
        
            document.getElementById('endTimeInput').value = formatDateTimeLocal(now);
            document.getElementById('startTimeInput').value = formatDateTimeLocal(oneDayAgo);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            setupDateTimeInputs(); // Set the initial date and time for inputs
            refreshIframe(); // Load the iframe content based on the default times
        });
    </script>
        
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar.style.transform === 'translateX(0px)') {
                sidebar.style.transform = 'translateX(-100%)'; // Hide the sidebar
            } else {
                sidebar.style.transform = 'translateX(0px)'; // Show the sidebar
            }
        }
        // Add event listener to handle window resizing
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth >= 768) {
                // Ensure sidebar is open on larger screens
                sidebar.style.transform = 'translateX(0px)';
            } else if (window.innerWidth < 768 && sidebar.style.transform === 'translateX(0px)') {
                // Keep current state if the sidebar is already open
                sidebar.style.transform = 'translateX(-100%)';
                return;
            } else {
                // Ensure sidebar is closed on smaller screens when not specifically toggled
                sidebar.style.transform = 'translateX(-100%)';
            }
        });

        function refreshIframe() {
            const iframe = document.getElementById('dataFrame');
            if (iframe.contentWindow) {
                loadIframeContent();
            } else {
                iframe.onload = loadIframeContent; // Wait for the iframe to load before loading content
            }
        }

        function formatDateTimeForAPI(datetimeValue) {
            // Adding seconds and 'Z' to make it ISO 8601 complete UTC time
            return new Date(datetimeValue).toISOString();
        }

        function loadIframeContent() {
            const iframe = document.getElementById('dataFrame');
            const startTime = formatDateTimeForAPI(document.getElementById('startTimeInput').value);
            const endTime = formatDateTimeForAPI(document.getElementById('endTimeInput').value);
            const range = document.getElementById('rangeInput').value;

            const selectedGraphType = document.querySelector('input[name="graphType"]:checked').value;
            let url = 'https://www.eco-sentry.com/generate-multi-sensor-graph';
            let bodyJSON = JSON.stringify({
                    startTime,
                    endTime,
                    longitude: fullLong,
                    latitude: fullLat,
                    range,
                    sensorTypes: getCheckedSensorIds()
                })
            if (selectedGraphType === 'multi-sensor') {
                url = 'https://www.eco-sentry.com/generate-multi-sensor-graph';
                bodyJSON = JSON.stringify({
                    startTime,
                    endTime,
                    longitude: fullLong,
                    latitude: fullLat,
                    range,
                    sensorTypes: getCheckedSensorIds()
                });
            } else if (selectedGraphType === 'correlation') {
                url = 'https://www.eco-sentry.com/generate-correlation-plot';
                bodyJSON = JSON.stringify({
                    startTime,
                    endTime,
                    longitude: fullLong,
                    latitude: fullLat,
                    range,
                    sensorTypes: getCheckedSensorIds()
                });
            }
            else if (selectedGraphType === 'heatmap') {
                url = 'https://www.eco-sentry.com/generate-heatmap';
                bodyJSON = JSON.stringify({
                    startTime,
                    endTime,
                    longitude: fullLong,
                    latitude: fullLat,
                    range,
                    sensorType: getCheckedSensorIds()
                });

                
            }
            else if (selectedGraphType === 'scatter') {
                url = 'https://www.eco-sentry.com/generate-scatter-plot';
                bodyJSON = JSON.stringify({
                    startTime,
                    endTime,
                    longitude: fullLong,
                    latitude: fullLat,
                    range,
                    sensorA: getCheckedSensorIds()[0],
                    sensorB: getCheckedSensorIds()[1]
                });
            }


            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: bodyJSON
            }).then(response => response.text())
            .then(html => {
                const doc = iframe.contentWindow.document;
                doc.open();
                doc.write(html);
                doc.close();
            }).catch(error => console.error('Error loading the iframe content:', error));
        }

        document.addEventListener('DOMContentLoaded', function () {
            const navbar = document.querySelector('.navbar');

            navbar.addEventListener('click', function(event) {
                if (window.innerWidth < 768) {
                    navbar.classList.toggle('active');
                    if (navbar.classList.contains('active')) {
                        navbar.style.height = '100vh'; // Full height
                    } else {
                        navbar.style.height = '60px'; // Default height
                    }
                }
            });

            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768) {
                    navbar.classList.remove('active');
                    navbar.style.height = '60px'; // Ensure default height
                }
            });

            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth >= 768) {
                // Ensure sidebar is open on larger screens
                sidebar.style.transform = 'translateX(0px)';
            } else if (window.innerWidth < 768 && sidebar.style.transform === 'translateX(0px)') {
                // Keep current state if the sidebar is already open
                return;
            } else {
                // Ensure sidebar is closed on smaller screens when not specifically toggled
                sidebar.style.transform = 'translateX(-100%)';
            }
        });

        refreshIframe(); // Initial load when everything is set up
    </script>
</body>
</html>
